(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{126:function(t,e,n){"use strict";var i=n(42);n.n(i).a},136:function(t,e,n){"use strict";var i=n(43);n.n(i).a},137:function(t,e,n){},138:function(t,e,n){"use strict";var i=n(44);n.n(i).a},139:function(t,e,n){},148:function(t,e,n){},149:function(t,e,n){"use strict";var i=n(45);n.n(i).a},153:function(t,e,n){"use strict";var i=n(46);n.n(i).a},154:function(t,e,n){"use strict";var i=n(47);n.n(i).a},155:function(t,e,n){"use strict";var i=n(48);n.n(i).a},156:function(t,e,n){"use strict";var i=n(49);n.n(i).a},157:function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"FabircMapVue",function(){return ge});n(70),n(55),n(56);var a=n(19),r=n.n(a),o=(n(24),n(39),n(105),n(1)),s=n.n(o),c=(n(25),n(13),n(80),n(79),n(109),n(121),n(0)),u={},h=n(2),l=n.n(h),p=n(90),f=n.n(p),d=n(68),m=function(){return n.e(7).then(n.bind(null,177)).then(function(t){return t.default||t})},v=function(){return n.e(3).then(n.bind(null,176)).then(function(t){return t.default||t})},g=function(){return n.e(2).then(n.bind(null,175)).then(function(t){return t.default||t})},x=function(){return n.e(4).then(n.bind(null,174)).then(function(t){return t.default||t})},y=function(){return n.e(6).then(n.bind(null,172)).then(function(t){return t.default||t})},b=function(){return n.e(5).then(n.bind(null,173)).then(function(t){return t.default||t})};c.a.use(d.a),window.history.scrollRestoration="manual";var w=function(t,e,n){var i=!1;return t.matched.length<2?i={x:0,y:0}:t.matched.some(function(t){return t.components.default.options.scrollToTop})&&(i={x:0,y:0}),n&&(i=n),new Promise(function(e){window.$nuxt.$once("triggerScroll",function(){if(t.hash){var n=t.hash;void 0!==window.CSS&&void 0!==window.CSS.escape&&(n="#"+window.CSS.escape(n.substr(1)));try{document.querySelector(n)&&(i={selector:n})}catch(t){console.warn("Failed to save scroll position. Please add CSS.escape() polyfill (https://github.com/mathiasbynens/CSS.escape).")}}e(i)})})};var C=n(91),k=n.n(C).a,P={name:"nuxt-child",functional:!0,props:["keepAlive"],render:function(t,e){var n=e.parent,i=e.data,a=e.props;i.nuxtChild=!0;for(var r=n,o=n.$nuxt.nuxt.transitions,s=n.$nuxt.nuxt.defaultTransition,c=0;n;)n.$vnode&&n.$vnode.data.nuxtChild&&c++,n=n.$parent;i.nuxtChildDepth=c;var u=o[c]||s,h={};_.forEach(function(t){void 0!==u[t]&&(h[t]=u[t])});var l={};M.forEach(function(t){"function"==typeof u[t]&&(l[t]=u[t].bind(r))});var p=l.beforeEnter;l.beforeEnter=function(t){if(window.$nuxt.$nextTick(function(){window.$nuxt.$emit("triggerScroll")}),p)return p.call(r,t)};var f=[t("router-view",i)];return void 0!==a.keepAlive&&(f=[t("keep-alive",f)]),t("transition",{props:h,on:l},f)}},_=["name","mode","appear","css","type","duration","enterClass","leaveClass","appearClass","enterActiveClass","enterActiveClass","leaveActiveClass","appearActiveClass","enterToClass","leaveToClass","appearToClass"],M=["beforeEnter","enter","afterEnter","enterCancelled","beforeLeave","leave","afterLeave","leaveCancelled","beforeAppear","appear","afterAppear","appearCancelled"],R={name:"nuxt-link",functional:!0,render:function(t,e){return t("router-link",e.data,e.children)}},S={name:"nuxt-error",props:["error"],head:function(){return{title:this.message,meta:[{name:"viewport",content:"width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"}]}},computed:{statusCode:function(){return this.error&&this.error.statusCode||500},message:function(){return this.error.message||"Error"}}},T=(n(126),n(4)),$=Object(T.a)(S,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"__nuxt-error-page"},[n("div",{staticClass:"error"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"90",height:"90",fill:"#DBE1EC",viewBox:"0 0 48 48"}},[n("path",{attrs:{d:"M22 30h4v4h-4zm0-16h4v12h-4zm1.99-10C12.94 4 4 12.95 4 24s8.94 20 19.99 20S44 35.05 44 24 35.04 4 23.99 4zM24 40c-8.84 0-16-7.16-16-16S15.16 8 24 8s16 7.16 16 16-7.16 16-16 16z"}})]),t._v(" "),n("div",{staticClass:"title"},[t._v(t._s(t.message))]),t._v(" "),404===t.statusCode?n("p",{staticClass:"description"},[n("nuxt-link",{staticClass:"error-link",attrs:{to:"/"}},[t._v("Back to the home page")])],1):t._e(),t._v(" "),t._m(0)])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"logo"},[e("a",{attrs:{href:"https://nuxtjs.org",target:"_blank",rel:"noopener"}},[this._v("Nuxt.js")])])}],!1,null,null,null);$.options.__file="nuxt-error.vue";var A=$.exports,E=(n(127),n(128),n(130),n(132),n(133),n(135),n(89),function(){return{}});function D(t,e){var n=t.options.data||E;!e&&t.options.hasAsyncData||(t.options.hasAsyncData=!0,t.options.data=function(){var i=n.call(this);return this.$ssrContext&&(e=this.$ssrContext.asyncData[t.cid]),l()({},i,e)},t._Ctor&&t._Ctor.options&&(t._Ctor.options.data=t.options.data))}function B(t){return t.options&&t._Ctor===t?t:(t.options?(t._Ctor=t,t.extendOptions=t.options):(t=c.a.extend(t))._Ctor=t,!t.options.name&&t.options.__file&&(t.options.name=t.options.__file),t)}function I(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.prototype.concat.apply([],t.matched.map(function(t,n){return Object.keys(t.components).map(function(i){return e&&e.push(n),t.components[i]})}))}function L(t,e){return Array.prototype.concat.apply([],t.matched.map(function(t,n){return Object.keys(t.components).reduce(function(i,a){return t.components[a]?i.push(e(t.components[a],t.instances[a],t,a,n)):delete t.components[a],i},[])}))}function j(t){return Promise.all(L(t,function(){var t=s()(regeneratorRuntime.mark(function t(e,n,i,a){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof e||e.options){t.next=4;break}return t.next=3,e();case 3:e=t.sent;case 4:return t.abrupt("return",i.components[a]=B(e));case 5:case"end":return t.stop()}},t,this)}));return function(e,n,i,a){return t.apply(this,arguments)}}()))}function O(t){return F.apply(this,arguments)}function F(){return(F=s()(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(e);case 2:return t.abrupt("return",l()({},e,{meta:I(e).map(function(t){return t.options.meta||{}})}));case 3:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function X(t,e){return q.apply(this,arguments)}function q(){return(q=s()(regeneratorRuntime.mark(function t(e,n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.to?n.to:n.route,e.context||(e.context={isStatic:!0,isDev:!1,isHMR:!1,app:e,payload:n.payload,error:n.error,base:"/fabric-map-vue/",env:{}},n.req&&(e.context.req=n.req),n.res&&(e.context.res=n.res),e.context.redirect=function(t,n,i){if(t){e.context._redirected=!0;var a=r()(n);if("number"==typeof t||"undefined"!==a&&"object"!==a||(i=n||{},n=t,a=r()(n),t=302),"object"===a&&(n=e.router.resolve(n).href),!/(^[.]{1,2}\/)|(^\/(?!\/))/.test(n))throw n=G(n,i),window.location.replace(n),new Error("ERR_REDIRECT");e.context.next({path:n,query:i,status:t})}},e.context.nuxtState=window.__NUXT__),e.context.next=n.next,e.context._redirected=!1,e.context._errored=!1,e.context.isHMR=!!n.isHMR,!n.route){t.next=10;break}return t.next=9,O(n.route);case 9:e.context.route=t.sent;case 10:if(e.context.params=e.context.route.params||{},e.context.query=e.context.route.query||{},!n.from){t.next=16;break}return t.next=15,O(n.from);case 15:e.context.from=t.sent;case 16:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function Y(t,e){var n;return(n=2===t.length?new Promise(function(n){t(e,function(t,i){t&&e.error(t),n(i=i||{})})}):t(e))&&(n instanceof Promise||"function"==typeof n.then)||(n=Promise.resolve(n)),n}function N(t,e){var n=window.location.pathname;return"hash"===e?window.location.hash.replace(/^#\//,""):(t&&0===n.indexOf(t)&&(n=n.slice(t.length)),(n||"/")+window.location.search+window.location.hash)}function H(t,e){return function(t){for(var e=new Array(t.length),n=0;n<t.length;n++)"object"===r()(t[n])&&(e[n]=new RegExp("^(?:"+t[n].pattern+")$"));return function(n,i){for(var a="",r=n||{},o=i||{},s=o.pretty?Z:encodeURIComponent,c=0;c<t.length;c++){var u=t[c];if("string"!=typeof u){var h,l=r[u.name];if(null==l){if(u.optional){u.partial&&(a+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(Array.isArray(l)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(l)+"`");if(0===l.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var p=0;p<l.length;p++){if(h=s(l[p]),!e[c].test(h))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(h)+"`");a+=(0===p?u.prefix:u.delimiter)+h}}else{if(h=u.asterisk?encodeURI(l).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}):s(l),!e[c].test(h))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+h+'"');a+=u.prefix+h}}else a+=u}return a}}(function(t,e){var n,i=[],a=0,r=0,o="",s=e&&e.delimiter||"/";for(;null!=(n=z.exec(t));){var c=n[0],u=n[1],h=n.index;if(o+=t.slice(r,h),r=h+c.length,u)o+=u[1];else{var l=t[r],p=n[2],f=n[3],d=n[4],m=n[5],v=n[6],g=n[7];o&&(i.push(o),o="");var x=null!=p&&null!=l&&l!==p,y="+"===v||"*"===v,b="?"===v||"*"===v,w=n[2]||s,C=d||m;i.push({name:f||a++,prefix:p||"",delimiter:w,optional:b,repeat:y,partial:x,asterisk:!!g,pattern:C?V(C):g?".*":"[^"+W(w)+"]+?"})}}r<t.length&&(o+=t.substr(r));o&&i.push(o);return i}(t,e))}function U(t,e){var n={},i=l()({},t,e);for(var a in i)String(t[a])!==String(e[a])&&(n[a]=!0);return n}window._nuxtReadyCbs=[],window.onNuxtReady=function(t){window._nuxtReadyCbs.push(t)};var z=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function Z(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function W(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function V(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function G(t,e){var n,i=t.indexOf("://");-1!==i?(n=t.substring(0,i),t=t.substring(i+3)):0===t.indexOf("//")&&(t=t.substring(2));var a,r=t.split("/"),o=(n?n+"://":"//")+r.shift(),s=r.filter(Boolean).join("/");return 2===(r=s.split("#")).length&&(s=r[0],a=r[1]),o+=s?"/"+s:"",e&&"{}"!==JSON.stringify(e)&&(o+=(2===t.split("?").length?"&":"?")+function(t){return Object.keys(t).sort().map(function(e){var n=t[e];return null==n?"":Array.isArray(n)?n.slice().map(function(t){return[e,"=",t].join("")}).join("&"):e+"="+n}).filter(Boolean).join("&")}(e)),o+=a?"#"+a:""}var J={name:"nuxt",props:["nuxtChildKey","keepAlive"],render:function(t){return this.nuxt.err?t("nuxt-error",{props:{error:this.nuxt.err}}):t("nuxt-child",{key:this.routerViewKey,props:this.$props})},beforeCreate:function(){c.a.util.defineReactive(this,"nuxt",this.$root.$options.nuxt)},computed:{routerViewKey:function(){if(void 0!==this.nuxtChildKey||this.$route.matched.length>1)return this.nuxtChildKey||H(this.$route.matched[0].path)(this.$route.params);var t=this.$route.matched[0]&&this.$route.matched[0].components.default;return t&&t.options&&t.options.key?"function"==typeof t.options.key?t.options.key(this.$route):t.options.key:this.$route.path}},components:{NuxtChild:P,NuxtError:A}},K={name:"nuxt-loading",data:function(){return{percent:0,show:!1,canSuccess:!0,throttle:200,duration:5e3,height:"2px",color:"#59cc93",failedColor:"red"}},methods:{start:function(){var t=this;return this.canSuccess=!0,this._throttle&&clearTimeout(this._throttle),this._timer&&(clearInterval(this._timer),this._timer=null,this.percent=0),this._throttle=setTimeout(function(){t.show=!0,t._cut=1e4/Math.floor(t.duration),t._timer=setInterval(function(){t.increase(t._cut*Math.random()),t.percent>95&&t.finish()},100)},this.throttle),this},set:function(t){return this.show=!0,this.canSuccess=!0,this.percent=Math.floor(t),this},get:function(){return Math.floor(this.percent)},increase:function(t){return this.percent=this.percent+Math.floor(t),this},decrease:function(t){return this.percent=this.percent-Math.floor(t),this},finish:function(){return this.percent=100,this.hide(),this},pause:function(){return clearInterval(this._timer),this},hide:function(){var t=this;return clearInterval(this._timer),this._timer=null,clearTimeout(this._throttle),this._throttle=null,setTimeout(function(){t.show=!1,c.a.nextTick(function(){setTimeout(function(){t.percent=0},200)})},500),this},fail:function(){return this.canSuccess=!1,this}}},Q=(n(136),Object(T.a)(K,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"nuxt-progress",style:{width:this.percent+"%",height:this.height,"background-color":this.canSuccess?this.color:this.failedColor,opacity:this.show?1:0}})},[],!1,null,null,null));Q.options.__file="nuxt-loading.vue";var tt=Q.exports,et=(n(137),{data:function(){return{tabs:[{name:"index",label:"热力地图"},{name:"zoom",label:"缩放类型"},{name:"coord",label:"地图定位"},{name:"distance",label:"距离绘制"},{name:"mapswitch",label:"地图切换"},{name:"background",label:"背景设置"}]}},created:function(){},methods:{handleTabClick:function(t){this.$router.push({name:t.name})}},components:{}}),nt=(n(138),Object(T.a)(et,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"layout layout-lr"},[n("div",{staticClass:"left-wrapper"},[n("ul",t._l(t.tabs,function(e){return n("li",{key:e.name,class:{active:t.$route.name===e.name},on:{click:function(n){t.handleTabClick(e)}}},[t._v(t._s(e.label))])}))]),t._v(" "),n("div",{staticClass:"right-wrapper"},[n("nuxt")],1)])},[],!1,null,null,null));nt.options.__file="default.vue";var it={_default:nt.exports},at={head:{title:"fabric map vue",meta:[{charset:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1"},{hid:"mobile-web-app-capable",name:"mobile-web-app-capable",content:"yes"},{hid:"apple-mobile-web-app-title",name:"apple-mobile-web-app-title",content:"fabric map vue"},{hid:"description",name:"description",content:"fabric map with Vue.js"},{hid:"theme-color",name:"theme-color",content:"#563d7c"},{hid:"og:type",name:"og:type",property:"og:type",content:"website"},{hid:"og:title",name:"og:title",property:"og:title",content:"fabric map vue"},{hid:"og:site_name",name:"og:site_name",property:"og:site_name",content:"fabric map vue"},{hid:"og:description",name:"og:description",property:"og:description",content:"fabric map with Vue.js"}],script:[{src:"/js/fabric.js"}],link:[{rel:"manifest",href:"/fabric-map-vue/_nuxt/manifest.531c7a23.json"}],style:[],htmlAttrs:{lang:"en"}},render:function(t,e){var n=t("nuxt-loading",{ref:"loading"}),i=t(this.layout||"nuxt"),a=t("div",{domProps:{id:"__layout"},key:this.layoutName},[i]),r=t("transition",{props:{name:"layout",mode:"out-in"}},[a]);return t("div",{domProps:{id:"__nuxt"}},[n,r])},data:function(){return{layout:null,layoutName:""}},beforeCreate:function(){c.a.util.defineReactive(this,"nuxt",this.$options.nuxt)},created:function(){c.a.prototype.$nuxt=this,"undefined"!=typeof window&&(window.$nuxt=this),this.error=this.nuxt.error},mounted:function(){this.$loading=this.$refs.loading},watch:{"nuxt.err":"errorChanged"},methods:{errorChanged:function(){this.nuxt.err&&this.$loading&&(this.$loading.fail&&this.$loading.fail(),this.$loading.finish&&this.$loading.finish())},setLayout:function(t){return t&&it["_"+t]||(t="default"),this.layoutName=t,this.layout=it["_"+t],this.layout},loadLayout:function(t){return t&&it["_"+t]||(t="default"),Promise.resolve(it["_"+t])}},components:{NuxtLoading:tt}},rt=n(69),ot=n.n(rt),st=(n(139),n(50)),ct=n.n(st),ut={TEXT:"text",IMG:"img",AREA:"area"},ht=(n(67),n(92)),lt=n.n(ht),pt=n(93),ft=n.n(pt),dt=n(30),mt={props:{heatmapOptions:{type:Object,default:function(){return{}}},heatmapMin:{type:Number,default:0},heatmapMax:{type:Number,default:100},heatmapData:{type:Array,default:function(){return[]}},heatmapClickDrawable:{type:Boolean,default:!1},heatmapMoveDrawable:{type:Boolean,default:!1},heatmapDrawValue:{type:Number,default:1}},methods:{initHeatMap:function(){this.$heatmapEl=this.$el.querySelector(".canvas-container"),this.heatmap=lt.a.create({container:this.$heatmapEl}),Object(dt.a)(this.$heatmapEl,this._handleHeatmapResize),this.renderHeatmap(),this.canvas.on("mouse:up",this.handleCanvasMouseUpForHeatmap),this.canvas.on("object:scaling",this.handleCanvasScalingForHeatmap),this.canvas.on("mouse:move",this.handleCanvasMouseMoveForHeatmap)},_handleHeatmapResize:function(){this.$heatmapEl&&this.heatmap.configure(l()({},this.heatmapOptions,{width:this.$heatmapEl.clientWidth,height:this.$heatmapEl.clientHeight}))},handleCanvasMouseUpForHeatmap:function(t){if(t.target===this.svgMap&&this.heatmapClickDrawable&&this.heatmap&&t.pointer&&this.svgMap.left===this.mouseDownSvgMapPointer.left&&this.svgMap.top===this.mouseDownSvgMapPointer.top){var e=t.pointer,n=e.x,i=e.y;this.requestCallAdd({x:n,y:i})}},handleCanvasScalingForHeatmap:function(t){t.target===this.svgMap&&this.renderHeatmap()},handleCanvasMouseMoveForHeatmap:function(t){if(t.target===this.svgMap){if(this.heatmapMoveDrawable&&this.heatmap&&t.pointer){var e=t.pointer,n=e.x,i=e.y;this.requestCallAdd({x:n,y:i})}this.renderHeatmap()}},requestCallAdd:ft()(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,n=t.y;this.callAdd({x:e,y:n})},15),callAdd:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,n=t.y,i=this.point2svgRelativeRateInfo({x:e,y:n},!0),a=i.coordX,r=i.coordY;this.callFun("heatmapAddCb",{coordX:a,coordY:r,value:this.heatmapDrawValue})},renderHeatmap:function(){var t=this,e=this.heatmapData.map(function(e){var n=e.coordX,i=void 0===n?0:n,a=e.coordY,r=void 0===a?0:a,o=ct()(e,["coordX","coordY"]),s=t.svgRateInfo2Point({coordX:i,coordY:r},!0),c=s.x,u=s.y;return l()({x:c,y:u},o)});this.heatmap&&this.heatmap.setData({max:this.heatmapMax,min:this.heatmapMin,data:e})},heatmapAddData:function(t){return this.heatmap&&this.heatmap.addData(t)},heatmapGetValueAt:function(t){return this.heatmap&&this.heatmap.getValueAt(t)},heatmapGetData:function(){return this.heatmap&&this.heatmap.getData()},heatmapGetDataURL:function(){return this.heatmap&&this.heatmap.getDataURL()},heatmapRepaint:function(){return this.heatmap&&this.heatmap.repaint()}},watch:{heatmapData:function(){this.renderHeatmap()},heatmapOptions:function(t){this.heatmap&&this.heatmap.configure(t)},heatmapMin:function(t){this.heatmap&&this.heatmap.setDataMin(t)},heatmapMax:function(t){this.heatmap&&this.heatmap.setDataMax(t)}}},vt=2,gt={props:{maxZoom:{type:Number,default:5},minZoom:{type:Number,default:.1},zoomRate:{type:Number,default:1e3},zoomType:{type:Number,default:1}},methods:{initZoom:function(){this.canvas.on("mouse:wheel",this.handleCanvasMousewheelForZoom),this.canvas.on("object:scaling",this.handleCanvasObjectScalingForZoom)},handleCanvasObjectScalingForZoom:function(t){if(this.svgMap){var e=this.zoomType===vt?this.svgMap.scaleX:this.canvas.getZoom(),n=!0,i=!1,a=void 0;try{for(var r,o=this.svgMap.getObjects()[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.mType&&"point"===s.mType&&s.mPointInfo&&(s.visible=!(s.mPointInfo.zoomThreshold&&e<s.mPointInfo.zoomThreshold))}}catch(t){i=!0,a=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}this.canvas.requestRenderAll()}},handleCanvasMousewheelForZoom:function(t){if(t.e&&t.e.stopPropagation(),this.svgMap){var e=t.e.deltaY;if(this.zoomType===vt){var n=Number(this.svgMap.scaleX);(n+=-e/this.zoomRate)>this.maxZoom&&(n=this.maxZoom),n<this.minZoom&&(n=this.minZoom),this.svgMap.scale(n)}else if(t.target===this.svgMap){var i=this.canvas.getZoom();(i+=-e/this.zoomRate)>this.maxZoom&&(i=this.maxZoom),i<this.minZoom&&(i=this.minZoom),this.canvas.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},i)}this.canvas.fire("object:scaling",{target:this.svgMap}),this.updatePointLine(),this.canvas.requestRenderAll()}},handleZoomOutBtnClick:function(){if(this.svgMap){if(this.activePoint&&this.rememberRelationShip(),this.zoomType===vt){var t=this.svgMap.scaleX;this.svgMap.scale(Math.min(Number(t)+.1,this.maxZoom))}else this.canvas.setZoom(Math.min(Number(this.canvas.getZoom())+.1,this.maxZoom));this.canvas.fire("object:scaling",{target:this.svgMap}),this.updatePointLine(),this.canvas.requestRenderAll()}},handleZoomInBtnClick:function(){if(this.svgMap){if(this.activePoint&&this.rememberRelationShip(),this.zoomType===vt){var t=this.svgMap.scaleX;this.svgMap.scale(Math.max(Number(t)-.1,.1))}else this.canvas.setZoom(Math.max(Number(this.canvas.getZoom())-.1,this.minZoom));this.canvas.fire("object:scaling",{target:this.svgMap}),this.canvas.requestRenderAll(),this.updatePointLine()}}}},xt=(n(143),{props:{clickActiveFillColor:{type:String,default:"red"},allowActiveAreaOnClick:{type:Boolean,default:!1}},methods:{initAreaDistinguish:function(){this.canvas.on("mouse:down",this.handleCanvasMouseDownForAreaDistinguish),this.canvas.on("mouse:up",this.handleCanvasMouseUpForAreaDistinguish),this.canvas.on("mouse:dblclick",this.handleCanvasMouseDbClickForAreaDistinguish)},handleCanvasMouseDownForAreaDistinguish:function(t){t&&t.subTargets&&t.subTargets.length>0&&(t.subTargets[0].mType&&"point"===t.subTargets[0].mType?this.$emit("pointClick",{info:t.subTargets[0].mPointInfo},t.subTargets[0],t):this.$emit("areaClick",{id:t.subTargets[0].id},t.subTargets[0],t),this.allowActiveAreaOnClick&&(this._distinguishTargetOriginInfo={fill:t.subTargets[0].fill},t.subTargets[0].set("fill",this.clickActiveFillColor),this.canvas.requestRenderAll()))},handleCanvasMouseUpForAreaDistinguish:function(t){var e=this;t&&t.subTargets&&t.subTargets.length>0&&(Object.keys(this._distinguishTargetOriginInfo||{}).forEach(function(n){console.log(n,e._distinguishTargetOriginInfo[n]),t.subTargets[0].set(n,e._distinguishTargetOriginInfo[n])}),this._distinguishTargetOriginInfo={},this.canvas.requestRenderAll())},handleCanvasMouseDbClickForAreaDistinguish:function(t){t&&t.subTargets&&t.subTargets.length>0&&(t.subTargets[0].mType&&"point"===t.subTargets[0].mType?this.$emit("pointDbClick",{info:t.subTargets[0].mPointInfo},t.subTargets[0],t):this.$emit("areaDbClick",{id:t.subTargets[0].id},t.subTargets[0],t))}}}),yt=n(51),bt=n.n(yt),wt=n(52),Ct=n.n(wt),kt=n(53),Pt=n.n(kt),_t=n(18),Mt=n.n(_t),Rt=n(94),St=n.n(Rt),Tt=n(54),$t=n.n(Tt),At={selectable:!1,strokeWidth:2,evented:!1,stroke:"red",text:"",textStyle:"red"},Et=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return bt()(this,e),Pt()(this,Mt()(e).call(this,t,l()({},At,n)))}return $t()(e,t),Ct()(e,[{key:"getLength",value:function(){var t=this.calcLinePoints(),e=t.x2-t.x1,n=t.y2-t.y1;return Math.sqrt(Math.pow(e,2)+Math.pow(n,2))}},{key:"_render",value:function(t){St()(Mt()(e.prototype),"_render",this).call(this,t);var n=this.calcLinePoints(),i=n.x2-n.x1,a=n.y2-n.y1;if(this.visible&&(i||a)){var r=Math.atan2(a,i);t.strokeStyle=this.stroke,this.strokeDashArray&&t.setLineDash(this.strokeDashArray),t.save(),t.translate((n.x2-n.x1)/2,(n.y2-n.y1)/2),t.rotate(r),t.moveTo(-8,8),t.lineTo(0,0),t.lineTo(-8,-8),t.stroke(),t.restore(),t.save(),t.translate(-(n.x2-n.x1)/2,-(n.y2-n.y1)/2),t.rotate(r),t.moveTo(8,8),t.lineTo(0,0),t.lineTo(8,-8),t.stroke(),t.restore(),t.save(),t.rotate(i>0?Math.atan2(a,i):Math.atan2(-a,-i)),t.fillStyle=this.textStyle,t.textAlign=i<=0?"left":"right",t.fillText(this.text,0,-10),t.restore()}}}]),e}(fabric.Line),Dt={props:{mapWidth:{type:Number,default:0},mapHeight:{type:Number,default:0},mapUnit:{type:String,default:"m"},showLine:{type:Boolean,default:!1}},methods:{initPointLine:function(){this.lineX=new Et([0,0,0,0]),this.lineY=new Et([0,0,0,0]),this.linxRightX=new Et([0,0,0,0]),this.linxRightY=new Et([0,0,0,0]),this.canvas.add(this.lineX),this.canvas.add(this.lineY),this.canvas.add(this.linxRightX),this.canvas.add(this.linxRightY)},updateLine:function(t,e){var n=this;if(!this.showLine)return this.clearLine();var i=this.svgMap,a=i.left,r=i.top,o=i.getScaledWidth(),s=i.getScaledHeight();if(e){var c=this.svgMap2CanvasPoint({x:t.left,y:t.top});t={left:c.x,top:c.y}}var u=[];i.forEachObject(function(e){if(!e.mType||"point"!==e.mType){var a=new fabric.Line([t.left,t.top,t.left,t.top]),r=e.width*i.scaleX,o=e.height*i.scaleY,s=n.svgMap2CanvasPoint({x:e.left,y:e.top}),c=new fabric.Point(s.x+r,s.y+o);a.isContainedWithinRect(s,c)&&u.push(e)}});var h=u.reduce(function(t,e){return t?(e.width<t.width&&(t=e),t):e},void 0);if(h){var l=this.svgMap2CanvasPoint({x:h.left,y:h.top});a=l.x,r=l.y,o=h.width*i.scaleX,s=h.height*i.scaleY}var p=this.mapWidth,f=this.mapHeight,d=this.mapUnit;this.lineX.set({x1:a,y1:t.top,x2:t.left,y2:t.top}),this.lineY.set({x1:t.left,y1:r,x2:t.left,y2:t.top}),this.linxRightX.set({x2:t.left,y2:t.top,x1:a+o,y1:t.top}),this.linxRightY.set({x2:t.left,y2:t.top,x1:t.left,y1:r+s});var m=(this.lineX.getLength()/this.svgMap.getScaledWidth()*f).toFixed(2);this.lineX.text=m?"".concat(m).concat(d):"";var v=(this.lineY.getLength()/this.svgMap.getScaledHeight()*p).toFixed(2);this.lineY.text=v?"".concat(v).concat(d):"";var g=(this.linxRightX.getLength()/this.svgMap.getScaledWidth()*f).toFixed(2);this.linxRightX.text=g?"".concat(g).concat(d):"";var x=(this.linxRightY.getLength()/this.svgMap.getScaledHeight()*p).toFixed(2);this.linxRightY.text=x?"".concat(x).concat(d):"",this.lineX.setCoords(),this.lineY.setCoords(),this.linxRightX.setCoords(),this.linxRightY.setCoords(),this.canvas.discardActiveObject(),this.canvas.bringToFront(this.lineX),this.canvas.bringToFront(this.lineY),this.canvas.bringToFront(this.linxRightX),this.canvas.bringToFront(this.linxRightY),this.canvas.requestRenderAll()},clearLine:function(){this.lineX.set({x1:0,y1:0,x2:0,y2:0}),this.lineY.set({x1:0,y1:0,x2:0,y2:0}),this.linxRightX.set({x1:0,y1:0,x2:0,y2:0}),this.linxRightY.set({x1:0,y1:0,x2:0,y2:0}),this.lineX.setCoords(),this.lineY.setCoords(),this.linxRightX.setCoords(),this.linxRightY.setCoords(),this.canvas.requestRenderAll()},updatePointLine:function(){this.updateActivePointLine(),this.updateSelectedPointLine()},updateActivePointLine:function(){this.activePoint&&(this.activePoint.scale(this.svgMap.scaleX),this.updateLine(this.activePoint))},updateSelectedPointLine:function(){this.selectedPoint&&this.updateLine(this.selectedPoint,!0)}},watch:{mapWidth:function(){this.updatePointLine(),this.canvas&&this.canvas.requestRenderAll()},mapHeight:function(){this.updatePointLine(),this.canvas&&this.canvas.requestRenderAll()},mapUnit:function(){this.updatePointLine(),this.canvas&&this.canvas.requestRenderAll()}}},Bt=(n(148),function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};bt()(this,e),n=Pt()(this,Mt()(e).call(this,t,i));var a=i.parentEl;if(n.parentEl=a,a){var r=function(){n.setHeight(a.clientHeight),n.setWidth(a.clientWidth),n.requestRenderAll()};Object(dt.a)(a,function(){r()}),r()}return n}return $t()(e,t),Ct()(e,[{key:"destroy",value:function(){this.parentEl&&Object(dt.b)(this.parentEl)}}]),e}(fabric.Canvas)),It={methods:{handleDirBtnClick:function(t){this.$emit("change",t)}}},Lt=(n(149),Object(T.a)(It,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fm-dir-btn-wrapper"},[n("div",{staticClass:"fm-row"},[n("i",{staticClass:"fm-icon-up-circle",on:{click:function(e){t.handleDirBtnClick("up")}}})]),t._v(" "),n("div",{staticClass:"fm-row"},[n("i",{staticClass:"fm-icon-left-circle",on:{click:function(e){t.handleDirBtnClick("left")}}}),t._v(" "),n("i",{staticClass:"fm-icon-right-circle",on:{click:function(e){t.handleDirBtnClick("right")}}})]),t._v(" "),n("div",{staticClass:"fm-row"},[n("i",{staticClass:"fm-icon-down-circle",on:{click:function(e){t.handleDirBtnClick("down")}}})])])},[],!1,null,null,null));Lt.options.__file="dir-btn.vue";var jt=Lt.exports,Ot=(n(95),{props:{width:{type:String,default:"50%"},minHeight:{type:String,default:"100px"},visible:{type:Boolean,default:!1}},methods:{handleCloseBtnClick:function(){this.$emit("update:visible",!1),this.$emit("close")}}}),Ft=(n(153),Object(T.a)(Ot,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}]},[n("div",{staticClass:"fm-dialog"},[n("div",{staticClass:"fm-dialog-content",style:{width:t.width,"min-height":t.minHeight}},[n("div",{staticClass:"fm-dialog-close-btn",on:{click:function(e){return e.preventDefault(),t.handleCloseBtnClick(e)}}},[t._v("x")]),t._v(" "),n("div",{staticClass:"fm-dialog-body"},[t._t("default")],2)])])])},[],!1,null,null,null));Ft.options.__file="FmDialog.vue";var Xt=Ft.exports,qt={props:{data:{type:Object,default:function(){return{}}}},data:function(){return{form:{text:"",fontSize:"",fill:"",angle:""}}},mounted:function(){this.form=l()({},this.form,this.data)},methods:{handleSubmitBtnClick:function(){var t=this;this.form.text&&this.$emit("submit",Object.keys(this.form).reduce(function(e,n){return(t.form[n]||0===t.form[n])&&(e[n]=t.form[n]),e},{}))}}},Yt=(n(154),Object(T.a)(qt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{staticClass:"fm-form"},[n("div",{staticClass:"fm-form-item"},[n("label",[t._v("文本内容:")]),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.text,expression:"form.text",modifiers:{trim:!0}}],attrs:{placeholder:"例如：text"},domProps:{value:t.form.text},on:{input:function(e){e.target.composing||t.$set(t.form,"text",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"fm-form-item"},[n("label",[t._v("字体大小:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.fontSize,expression:"form.fontSize",modifiers:{number:!0}}],attrs:{placeholder:"例如：16"},domProps:{value:t.form.fontSize},on:{input:function(e){e.target.composing||t.$set(t.form,"fontSize",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"fm-form-item"},[n("label",[t._v("       颜色:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.fill,expression:"form.fill"}],attrs:{placeholder:"例如：red或者#FF0000"},domProps:{value:t.form.fill},on:{input:function(e){e.target.composing||t.$set(t.form,"fill",e.target.value)}}})]),t._v(" "),n("div",{staticClass:"fm-form-item"},[n("label",[t._v("旋转角度:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.angle,expression:"form.angle",modifiers:{number:!0}}],attrs:{placeholder:"例如：50"},domProps:{value:t.form.angle},on:{input:function(e){e.target.composing||t.$set(t.form,"angle",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"fm-btn-wrapper"},[n("button",{staticClass:"fm-btn",on:{click:function(e){return e.preventDefault(),t.handleSubmitBtnClick(e)}}},[t._v("确定")])])])},[],!1,null,null,null));Yt.options.__file="FmTextForm.vue";var Nt=Yt.exports,Ht={props:{data:{type:Object,default:function(){return{}}}},data:function(){return{form:{url:"",angle:""}}},mounted:function(){this.form=l()({},this.form,this.data)},methods:{handleSubmitBtnClick:function(){var t=this;this.form.url&&this.$emit("submit",Object.keys(this.form).reduce(function(e,n){return(t.form[n]||0===t.form[n])&&(e[n]=t.form[n]),e},{}))}}},Ut=(n(155),Object(T.a)(Ht,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{staticClass:"fm-form"},[n("div",{staticClass:"fm-form-item"},[n("label",[t._v("图片地址:")]),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.url,expression:"form.url",modifiers:{trim:!0}}],attrs:{placeholder:"例如：http://vve.qiniu.qjzd.net/Fn4PgPav04qGpPzpIDw_1qyK9F5Y"},domProps:{value:t.form.url},on:{input:function(e){e.target.composing||t.$set(t.form,"url",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"fm-form-item"},[n("label",[t._v("旋转角度:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.angle,expression:"form.angle",modifiers:{number:!0}}],attrs:{placeholder:"例如：50"},domProps:{value:t.form.angle},on:{input:function(e){e.target.composing||t.$set(t.form,"angle",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"fm-btn-wrapper"},[n("button",{staticClass:"fm-btn",on:{click:function(e){return e.preventDefault(),t.handleSubmitBtnClick(e)}}},[t._v("确定")])])])},[],!1,null,null,null));Ut.options.__file="FmImgForm.vue";var zt=Ut.exports,Zt=[{type:ut.TEXT,text:"文本",component:Nt},{type:ut.IMG,text:"图片",component:zt}],Wt={props:{data:{type:Object,required:!1}},components:{FmTextForm:Nt,FmDialog:Xt},data:function(){return{TYPELIST:Zt,POINT_TYPE_ENUM:ut,visible:!0,formVisible:!1,fmType:{}}},mounted:function(){var t=this;this.data&&(this.fmType=Zt.find(function(e){return e.type===t.data.type})||{},this.fmType.type&&(this.formVisible=!0,this.visible=!1))},methods:{handleItemClick:function(t){this.fmType=t,this.visible=!1,this.formVisible=!0},handleFormCloseBtnClick:function(){this.data?this.$emit("close"):this.visible=!0},handleFormSubmit:function(t){this.$emit("submit",l()({type:this.fmType.type},t))},handleCloseBtnClick:function(){this.$emit("close")}}},Vt=(n(156),Object(T.a)(Wt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("fm-dialog",{attrs:{visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.handleCloseBtnClick}},[n("p",[t._v("选择类型")]),t._v(" "),n("div",{staticClass:"fm-type-select-wrapper"},t._l(t.TYPELIST,function(e){return n("div",{key:e.type,staticClass:"fm-type",on:{click:function(n){t.handleItemClick(e)}}},[n("span",{domProps:{textContent:t._s(e.text)}})])}))]),t._v(" "),n("fm-dialog",{attrs:{visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e},close:t.handleFormCloseBtnClick}},[n(t.fmType.component,{tag:"component",attrs:{data:t.data},on:{submit:t.handleFormSubmit}})],1)],1)},[],!1,null,null,null));function Gt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.reduce(function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t},{})}Vt.options.__file="FmForm.vue";var Jt,Kt,Qt,te,ee,ne,ie,ae,re,oe,se,ce,ue,he,le={mixins:[mt,gt,xt,Dt],components:{DirBtn:jt,FmForm:Vt.exports},props:{svgMapUrl:{type:String,default:"https://qiniu.qjzd.net/cf.svg"},pointList:{type:Array,default:function(){return[]}},changeCb:{type:Function,default:function(){return function(){}}},deleteCb:{type:Function,default:function(){return function(){}}},movingMinion:{type:Boolean,default:!1},scalingMinion:{type:Boolean,default:!1},backgroundColor:{type:String,default:"#17171A"},showOp:{type:Boolean,default:!1}},data:function(){return{addTipInfoShow:!1,activePoint:void 0,selectedPoint:void 0,formShow:!1,readyPointInfo:void 0,editPointInfo:void 0}},computed:{lockBtn:function(){return!this.activePoint},showLockBtn:function(){return this.selectedPoint||this.activePoint},showOpBtnWrapper:function(){var t=this.selectedPoint||this.activePoint;return!!t&&t.mPointInfo&&t.mPointInfo.type!==ut.AREA},showDeleteBtn:function(){return this.activePoint||this.selectedPoint},showEditBtn:function(){return this.selectedPoint},showAddPointBtn:function(){return!(this.selectedPoint||this.activePoint||this.addTipInfoShow||this.formShow)},showDirBtn:function(){return!!this.activePoint},pointInfo:function(){return this.selectedPoint&&this.selectedPoint.mPointInfo||{}},mPointList:function(){return this.pointList}},watch:{svgMapUrl:function(t){this.renderSvgMap(t)},pointList:function(){this.renderPoints(),this.canvas&&this.canvas.requestRenderAll()},backgroundColor:function(t){this.canvas&&(this.canvas.backgroundColor=t),this.canvas&&this.canvas.requestRenderAll()}},mounted:(he=s()(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.draw();case 2:this.initPointLine(),this.initZoom(),this.initHeatMap(),this.initAreaDistinguish();case 6:case"end":return t.stop()}},t,this)})),function(){return he.apply(this,arguments)}),beforeDestroy:function(){this.canvas&&this.canvas.destroy()},methods:{handleFormSubmit:(ue=s()(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.formShow=!1,e.id){t.next=6;break}this.readyPointInfo=e,this.addTipInfoShow=!0,t.next=10;break;case 6:return this.editPointInfo=void 0,t.next=9,this.callFun("changeCb",e);case 9:this.selectedPoint=null;case 10:case"end":return t.stop()}},t,this)})),function(t){return ue.apply(this,arguments)}),callFun:(ce=s()(regeneratorRuntime.mark(function t(e){var n,i,a,r=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n=r.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=r[a];if(this.$emit.apply(this,[e.replace("Cb","")].concat(i)),!this[e]||!this[e].then){t.next=7;break}return t.next=5,this[e].apply(this,i);case 5:t.next=8;break;case 7:this[e]&&this[e].apply(this,i);case 8:case"end":return t.stop()}},t,this)})),function(t){return ce.apply(this,arguments)}),savePointInfo:(se=s()(regeneratorRuntime.mark(function t(){var e,n=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},t.next=3,this.callFun("changeCb",e);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}},t,this)})),function(){return se.apply(this,arguments)}),draw:(oe=s()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(e=new Bt(this.$el.querySelector("#map-canvas"),{parentEl:this.$el.querySelector(".fm-map-wrapper")})).backgroundColor=this.backgroundColor,e.selection=!1,this.canvas=e,t.next=6,this.renderSvgMap(this.svgMapUrl);case 6:e.on("mouse:down",this.handleCanvasMouseDown),e.on("object:scaling",this.handleCanvasScaling),e.on("object:moving",this.handleCanvasMoving),e.on("mouse:up",this.handleCanvasMouseUp);case 10:case"end":return t.stop()}},t,this)})),function(){return oe.apply(this,arguments)}),clearPoints:function(){if(this.svgMap){var t=!0,e=!1,n=void 0;try{for(var i,a=this.svgMap.getObjects()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var r=i.value;r.mType&&"point"===r.mType&&this.svgMap.remove(r)}}catch(t){e=!0,n=t}finally{try{t||null==a.return||a.return()}finally{if(e)throw n}}}},makePointImageObj:(re=s()(regeneratorRuntime.mark(function t(){var e,n,i,a,r,o,s,c=this,u=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=u.length>0&&void 0!==u[0]?u[0]:{},n=e.mPointInfo,i=void 0===n?{}:n,a=ct()(e,["mPointInfo"]),i.type!==ut.IMG||!i.url){t.next=10;break}return t.next=5,this.loadImage(i.url,Gt(["angle","stroke","strokeWidth","fill","backgroundColor","opacity"],i));case 5:(r=t.sent).originX=i.originX||"center",r.originY=i.originY||"center",t.next=26;break;case 10:if(i.type!==ut.TEXT||!i.text){t.next=16;break}(r=new fabric.IText(i.text,Gt(["angle","stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor","backgroundColor","opacity"],i))).originX=i.originX||"center",r.originY=i.originY||"center",t.next=26;break;case 16:if(i.type!==ut.AREA){t.next=25;break}o=i.startPoints||[],i.absolute&&(o=o.map(function(t){return{coordX:t.x/c.svgMap.width,coordY:t.y/c.svgMap.height}})),s=o.map(function(t){var e=c.svgRateInfo2Point({coordX:t.coordX,coordY:t.coordY}),n=e.x,i=e.y;return c.canvas2SvgMapPoint({x:n,y:i})}),(r=new fabric.Polygon(s,l()({fill:"transparent",stroke:"red",strokeWidth:2,strokeDashArray:[5,5]},Gt(["angle","stroke","strokeWidth","fill","strokeDashArray"],i)))).originX="left",r.originY="top",t.next=26;break;case 25:return t.abrupt("return");case 26:return r.hasControls=!1,r.hasBorders=!1,r.lockRotation=!0,r.mPointInfo=Object.keys(i).length>0?i:void 0,r.mType="point",r.set(a),r.setCoords(),this.initPointEvents(r),t.abrupt("return",r);case 35:case"end":return t.stop()}},t,this)})),function(){return re.apply(this,arguments)}),renderPoints:(ae=s()(regeneratorRuntime.mark(function t(){var e,n,i,a,r,o,s,c,u,h,l,p,f,d,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.clearPoints(),this.timestampForRenderPoints=(new Date).getTime(),e=!0,n=!1,i=void 0,t.prev=5,a=this.mPointList[Symbol.iterator]();case 7:if(e=(r=a.next()).done){t.next=20;break}return o=r.value,s=o.coordX,c=o.coordY,u=o.type,h=this.svgRateInfo2Point({coordX:s,coordY:c}),l=h.x,p=h.y,f=this.canvas2SvgMapPoint({x:l,y:p}),d=u===ut.AREA?{mPointInfo:o,mTimestampForRenderPoints:this.timestampForRenderPoints}:{mPointInfo:o,mTimestampForRenderPoints:this.timestampForRenderPoints,left:f.x,top:f.y},t.next=15,this.makePointImageObj(d);case 15:(m=t.sent)&&m.mTimestampForRenderPoints===this.timestampForRenderPoints&&(this.svgMap.add(m),this.canvas.requestRenderAll());case 17:e=!0,t.next=7;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(5),n=!0,i=t.t0;case 26:t.prev=26,t.prev=27,e||null==a.return||a.return();case 29:if(t.prev=29,!n){t.next=32;break}throw i;case 32:return t.finish(29);case 33:return t.finish(26);case 34:this.canvas.fire("object:scaling",{target:this.svgMap});case 35:case"end":return t.stop()}},t,this,[[5,22,26,34],[27,,29,33]])})),function(){return ae.apply(this,arguments)}),renderSvgMap:(ie=s()(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.svgMap&&(this.handleReloadBtnClick(),this.canvas.remove(this.svgMap),this.svgMap.destroy()),t.next=3,this.loadSvgMap(e);case 3:return this.svgMap=t.sent,this.svgMap.hasControls=!1,this.svgMap.hasBorders=!1,this.svgMap.on("mousedown",this.handleSvgMapMouseDown),this.svgMap.on("mouseup",this.handleSvgMapMouseUp),this.svgMap.on("mousemove",this.handleSvgMapMouseMove),this.svgMap.on("scaling",this.handleSvgMapScaling),this.svgMap.on("scaled",this.handleSvgMapScaled),this.initSvgMapPosition(),t.next=14,this.renderPoints();case 14:this.canvas.add(this.svgMap);case 15:case"end":return t.stop()}},t,this)})),function(t){return ie.apply(this,arguments)}),loadSvgMap:(ne=s()(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){fabric.loadSVGFromURL(e,function(){var e=s()(regeneratorRuntime.mark(function e(n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=fabric.util.groupSVGElements(n,l()({},i,{lockRotation:!0,subTargetCheck:!0})),t(a);case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())},{crossOrigin:"anonymous"}));case 1:case"end":return t.stop()}},t,this)})),function(t){return ne.apply(this,arguments)}),initSvgMapPosition:function(){var t=this.$el.querySelector(".fm-map-wrapper"),e=t.clientWidth,n=t.clientHeight,i=Math.min(e/this.svgMap.width,n/this.svgMap.height).toFixed(1);this.svgMap.scale(i),this.svgMap.top=Math.floor(n/2-this.svgMap.getScaledHeight()/2),this.svgMap.left=Math.floor(e/2-this.svgMap.getScaledWidth()/2),this.svgMap.setCoords(),this.canvas.fire("object:scaling",{target:this.svgMap}),this.svgMap.fire("scaling")},loadImage:(ee=s()(regeneratorRuntime.mark(function t(e,n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,i){fabric.Image.fromURL(e,function(e){t(e)},n)}));case 1:case"end":return t.stop()}},t,this)})),function(t,e){return ee.apply(this,arguments)}),limitActivePointPosition:function(){if(this.svgMap&&this.activePoint){var t=this.activePoint,e=this.svgMap,n=e.top,i=n+e.getScaledHeight(),a=e.left,r=a+e.getScaledWidth(),o=t.getScaledWidth(),s=t.getScaledHeight();"center"===t.originX?t.left=Math.min(Math.max(t.left,a+o/2),r-s/2):"left"===t.originX&&(t.left=Math.min(Math.max(t.left,a),r-s)),"bottom"===t.originY?t.top=Math.min(Math.max(t.top,n+s),i):"top"===t.originY?t.top=Math.min(Math.max(t.top,n),i-s):"center"===t.originY&&(t.top=Math.min(Math.max(t.top,n+s/2),i-s/2)),t.setCoords(),this.canvas.requestRenderAll()}},rememberRelationShip:function(){if(this.activePoint&&this.svgMap){var t=this.svgMap.calcTransformMatrix(),e=fabric.util.invertTransform(t);this.activePoint.relationship=fabric.util.multiplyTransformMatrices(e,this.activePoint.calcTransformMatrix())}},updateMinions:function(){if(this.activePoint&&this.svgMap&&this.activePoint.relationship){var t=this.activePoint,e=this.svgMap,n=t.relationship,i=fabric.util.multiplyTransformMatrices(e.calcTransformMatrix(),n),a=fabric.util.qrDecompose(i);t.set({flipX:!1,flipY:!1}),t.setPositionByOrigin({x:a.translateX,y:a.translateY},"center","center"),t.set(a),t.setCoords()}},handleCanvasMouseDown:function(t){t.e&&t.e.stopPropagation(),this.canvas.discardActiveObject(),this.rememberRelationShip()},handleCanvasScaling:function(t){this.scalingMinion&&this.updateMinions(),this.limitActivePointPosition()},handleCanvasMoving:function(t){t.e&&t.e.stopPropagation(),t.target===this.svgMap&&this.movingMinion&&this.updateMinions(),this.updatePointLine(),this.limitActivePointPosition()},handleCanvasMouseUp:function(t){this.selectedPoint&&!t.target&&(this.selectedPoint=null,this.clearLine()),this.rememberRelationShip()},handleSvgMapMouseUp:(te=s()(regeneratorRuntime.mark(function t(e){var n,i,a,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.svgMap.left!==this.mouseDownSvgMapPointer.left||this.svgMap.top!==this.mouseDownSvgMapPointer.top){t.next=11;break}if(this.selectedPoint&&(this.selectedPoint=null,this.clearLine()),this.addTipInfoShow||this.readyPointInfo){t.next=4;break}return t.abrupt("return");case 4:return this.addTipInfoShow=!1,n=this.invertPointer(e.pointer),i=n.x,a=n.y,t.next=8,this.makePointImageObj({left:i,top:a,mPointInfo:this.readyPointInfo});case 8:r=t.sent,this.readyPointInfo=null,r&&(this.canvas.add(r),this.canvas.bringToFront(r),this.selectedPoint=null,this.activePoint=r,this.updatePointLine());case 11:case"end":return t.stop()}},t,this)})),function(t){return te.apply(this,arguments)}),handleSvgMapMouseDown:function(t){t.e&&t.e.stopPropagation(),this.mouseDownSvgMapPointer={left:this.svgMap.left,top:this.svgMap.top},this.activePoint&&this.updatePointLine()},handleSvgMapMouseMove:function(t){t.e&&t.e.stopPropagation()},handleSvgMapScaling:function(t){this.updatePointLine()},handleSvgMapScaled:function(){this.updatePointLine()},initPointEvents:function(t){var e=this;t.on("mousedown",function(t){t.e&&t.e.stopPropagation()}),t.on("mousemove",function(t){t.e&&t.e.stopPropagation(),e.updatePointLine()}),t.on("mouseup",function(n){e.activePoint||(e.selectedPoint=t)})},removeActivePoint:function(){this.activePoint&&(this.canvas.remove(this.activePoint),this.clearLine(),this.activePoint=null)},removeSelectPoint:function(){this.selectedPoint&&(this.svgMap.remove(this.selectedPoint),this.clearLine(),this.selectedPoint=null)},addActivePointToSvgMap:function(){if(this.activePoint){this.svgMap.scaleX;var t=this.canvas2SvgMapPoint({x:this.activePoint.left,y:this.activePoint.top});this.activePoint.scale(1),this.activePoint.left=t.x,this.activePoint.top=t.y,this.activePoint.setCoords(),this.svgMap.add(this.activePoint)}},handleAddPointBtnClick:function(){this.editPointInfo=void 0,this.formShow=!0},handleDelBtnClick:(Qt=s()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.activePoint||this.selectedPoint)){t.next=8;break}if(t.t0=e.mPointInfo,!t.t0){t.next=6;break}return t.next=6,this.callFun("deleteCb",e.mPointInfo);case 6:this.removeActivePoint(),this.removeSelectPoint();case 8:case"end":return t.stop()}},t,this)})),function(){return Qt.apply(this,arguments)}),handleEditBtnClick:function(){var t=this.activePoint||this.selectedPoint;t&&t.mPointInfo&&(this.editPointInfo=t.mPointInfo,this.formShow=!0)},invertPointer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,n=t.y,i=fabric.util.invertTransform(this.canvas.viewportTransform);return fabric.util.transformPoint({x:e,y:n},i)},point2svgRelativeRateInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,n=t.y;if(arguments.length>1?arguments[1]:void 0){var i=fabric.util.invertTransform(this.canvas.viewportTransform),a=fabric.util.transformPoint({x:e,y:n},i);e=a.x,n=a.y}var r=(n-this.svgMap.top)/this.svgMap.getScaledHeight();return{coordX:(e-this.svgMap.left)/this.svgMap.getScaledWidth(),coordY:r}},svgRateInfo2Point:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.coordX,n=t.coordY,i=arguments.length>1?arguments[1]:void 0;if(!this.svgMap)return{};var a=Math.round(e*this.svgMap.getScaledWidth()+this.svgMap.left),r=Math.round(n*this.svgMap.getScaledHeight()+this.svgMap.top);if(i){var o=fabric.util.transformPoint({x:a,y:r},this.canvas.viewportTransform);a=Math.floor(o.x),r=Math.floor(o.y)}return{x:a,y:r}},savePoint:(Kt=s()(regeneratorRuntime.mark(function t(){var e,n,i,a,r,o,s,c,u,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.activePoint||this.selectedPoint,n=e===this.selectedPoint,i=e.left,a=e.top,n&&(r=this.svgMap2CanvasPoint({x:e.left,y:e.top}),i=r.x,a=r.y),o=this.point2svgRelativeRateInfo({x:i,y:a}),s=o.coordX,c=o.coordY,u=e.mPointInfo,h=void 0===u?{}:u,t.next=8,this.savePointInfo(l()({},h,{coordX:s,coordY:c}));case 8:t.sent;case 9:case"end":return t.stop()}},t,this)})),function(){return Kt.apply(this,arguments)}),handleUnLockBtnClick:(Jt=s()(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.activePoint){t.next=4;break}return t.next=3,this.savePoint();case 3:this.removeActivePoint();case 4:case"end":return t.stop()}},t,this)})),function(){return Jt.apply(this,arguments)}),handleLockBtnClick:function(){if(this.selectedPoint){this.svgMap.remove(this.selectedPoint),this.activePoint=this.selectedPoint,this.selectedPoint=null;var t=this.activePoint;t.hasControls=!1,t.hasBorders=!1,t.lockRotation=!0;var e=this.svgMap2CanvasPoint({x:t.left,y:t.top});t.leftBackup=e.x,t.topBackup=e.y,t.left=e.x,t.top=e.y,t.scale(this.svgMap.scaleX),t.setCoords(),this.canvas.add(t)}},handleDirBtnClick:function(t){var e=this.activePoint||this.selectedPoint;"up"===t?e.top-=1:"down"===t?e.top+=1:"left"===t?e.left-=1:"right"===t&&(e.left+=1),e===this.selectedPoint&&(this.svgMap.remove(e),this.svgMap.add(e)),this.canvas.fire("object:moving",{target:e}),this.updatePointLine()},handleReloadBtnClick:function(){this.svgMap&&(this.activePoint&&(this.activePoint.leftBackup&&this.activePoint.topBackup?(this.canvas.remove(this.activePoint),this.activePoint.left=this.activePoint.leftBackup,this.activePoint.top=this.activePoint.topBackup,this.addActivePointToSvgMap()):this.canvas.remove(this.activePoint),this.activePoint=null),this.selectedPoint=null,this.clearLine(),this.canvas.viewportTransform=[1,0,0,1,0,0],this.initSvgMapPosition(),this.canvas.requestRenderAll())},canvas2SvgMapPoint:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,n=t.y;if(!this.svgMap)return{};var i=this.svgMap.calcTransformMatrix(),a=fabric.util.invertTransform(i);return fabric.util.transformPoint({x:e,y:n},a)},svgMap2CanvasPoint:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,n=t.y,i=this.svgMap.calcTransformMatrix();return fabric.util.transformPoint({x:e,y:n},i)}}},pe=Object(T.a)(le,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fm-svg-map-wrapper",style:{"background-color":t.backgroundColor}},[t._m(0),t._v(" "),t.showOp?n("div",[n("div",{staticClass:"fm-zoom-btn-wrapper"},[n("i",{staticClass:"fm-icon-plus",on:{click:t.handleZoomOutBtnClick}}),t._v(" "),n("i",{staticClass:"fm-icon-minus",on:{click:t.handleZoomInBtnClick}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showAddPointBtn,expression:"showAddPointBtn"}],staticClass:"fm-add-btn-wrapper"},[n("i",{staticClass:"fm-icon-plus-circle",on:{click:t.handleAddPointBtnClick}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showOpBtnWrapper,expression:"showOpBtnWrapper"}],staticClass:"fm-op-btn-wrapper"},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.showEditBtn,expression:"showEditBtn"}],staticClass:"fm-icon-edit",on:{click:t.handleEditBtnClick}}),t._v(" "),n("i",{directives:[{name:"show",rawName:"v-show",value:t.showDeleteBtn,expression:"showDeleteBtn"}],staticClass:"fm-icon-delete",on:{click:t.handleDelBtnClick}}),t._v(" "),t.showLockBtn?n("i",{directives:[{name:"show",rawName:"v-show",value:t.lockBtn,expression:"lockBtn"}],staticClass:"fm-icon-lock",on:{click:t.handleLockBtnClick}}):t._e(),t._v(" "),t.showLockBtn?n("i",{directives:[{name:"show",rawName:"v-show",value:!t.lockBtn,expression:"!lockBtn"}],staticClass:"fm-icon-unlock",on:{click:t.handleUnLockBtnClick}}):t._e()]),t._v(" "),n("dir-btn",{directives:[{name:"show",rawName:"v-show",value:t.showDirBtn,expression:"showDirBtn"}],on:{change:t.handleDirBtnClick}}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.addTipInfoShow,expression:"addTipInfoShow"}],staticClass:"fm-add-tip-wrapper"},[n("p",[t._v("请在地图中点击以添加点")])]),t._v(" "),n("div",{staticClass:"fm-reload-wrapper"},[n("i",{staticClass:"fm-icon-reload",on:{click:t.handleReloadBtnClick}})]),t._v(" "),t.formShow?n("fm-form",{attrs:{data:t.editPointInfo},on:{close:function(e){t.formShow=!1},submit:t.handleFormSubmit}}):t._e()],1):t._e()])},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fm-map-wrapper"},[e("canvas",{staticClass:"fm-m-canvas",attrs:{id:"map-canvas"}})])}],!1,null,null,null);function fe(t,e,n){t._fm_components_installed=t._fm_components_installed||{};var i=t._fm_components_installed[e];return!i&&n&&e&&(t._fm_components_installed[e]=!0,t.component(e,n)),i}function de(t){"undefined"!=typeof window&&window.Vue&&window.Vue.use(t)}pe.options.__file="fabric-map-vue.vue";var me={fabricMapVue:pe.exports},ve={install:function(t){!function(t,e){for(var n in e)fe(t,n,e[n])}(t,me)}};de(ve);var ge=ve,xe={install:function(t){if(!t._fabric_map_vue)for(var e in t._fabric_map_vue=!0,i)t.use(i[e])}};de(xe);var ye=xe;c.a.use(ye),c.a.component(k.name,k),c.a.component(P.name,P),c.a.component(R.name,R),c.a.component(J.name,J),c.a.use(f.a,{keyName:"head",attribute:"data-n-head",ssrAttribute:"data-n-head-ssr",tagIDKeyName:"hid"});var be={name:"page",mode:"out-in",appear:!1,appearClass:"appear",appearActiveClass:"appear-active",appearToClass:"appear-to"};function we(){return(we=s()(regeneratorRuntime.mark(function t(e){var n,i,a,r,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a({mode:"history",base:"/fabric-map-vue/",linkActiveClass:"nuxt-link-active",linkExactActiveClass:"nuxt-link-exact-active",scrollBehavior:w,routes:[{path:"/zoom",component:m,name:"zoom"},{path:"/coord",component:v,name:"coord"},{path:"/background",component:g,name:"background"},{path:"/distance",component:x,name:"distance"},{path:"/mapswitch",component:y,name:"mapswitch"},{path:"/",component:b,name:"index"}],fallback:!1});case 2:return n=t.sent,i=l()({router:n,nuxt:{defaultTransition:be,transitions:[be],setTransitions:function(t){return Array.isArray(t)||(t=[t]),t=t.map(function(t){return t=t?"string"==typeof t?Object.assign({},be,{name:t}):Object.assign({},be,t):be}),this.$options.nuxt.transitions=t,t},err:null,dateErr:null,error:function(t){t=t||null,i.context._errored=!!t,"string"==typeof t&&(t={statusCode:500,message:t});var n=this.nuxt||this.$options.nuxt;return n.dateErr=Date.now(),n.err=t,e&&(e.nuxt.error=t),t}}},at),a=e?e.next:function(t){return i.router.push(t)},e?r=n.resolve(e.url).route:(o=N(n.options.base),r=n.resolve(o).route),t.next=8,X(i,{route:r,next:a,error:i.nuxt.error.bind(i),payload:e?e.payload:void 0,req:e?e.req:void 0,res:e?e.res:void 0,beforeRenderFns:e?e.beforeRenderFns:void 0});case 8:if(s=function(t,e){if(!t)throw new Error("inject(key, value) has no key provided");if(!e)throw new Error("inject(key, value) has no value provided");i[t="$"+t]=e;var n="__nuxt_"+t+"_installed__";c.a[n]||(c.a[n]=!0,c.a.use(function(){c.a.prototype.hasOwnProperty(t)||Object.defineProperty(c.a.prototype,t,{get:function(){return this.$root.$options[t]}})}))},"function"!=typeof ot.a){t.next=13;break}return t.next=13,ot()(i.context,s);case 13:t.next=16;break;case 16:t.next=19;break;case 19:return t.abrupt("return",{app:i,router:n});case 20:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}var Ce,ke,Pe=[],_e=window.__NUXT__||{};function Me(t,e,n){var i=function(t){var i=function(t,e){if(!t||!t.options||!t.options[e])return{};var n=t.options[e];if("function"==typeof n){for(var i=arguments.length,a=new Array(i>2?i-2:0),r=2;r<i;r++)a[r-2]=arguments[r];return n.apply(void 0,a)}return n}(t,"transition",e,n)||{};return"string"==typeof i?{name:i}:i};return t.map(function(t){var e=Object.assign({},i(t));if(n&&n.matched.length&&n.matched[0].components.default){var a=i(n.matched[0].components.default);Object.keys(a).filter(function(t){return a[t]&&-1!==t.toLowerCase().indexOf("leave")}).forEach(function(t){e[t]=a[t]})}return e})}function Re(t,e,n){return Se.apply(this,arguments)}function Se(){return(Se=s()(regeneratorRuntime.mark(function t(e,n,i){var a,r,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._pathChanged=!!Ce.nuxt.err||n.path!==e.path,this._queryChanged=JSON.stringify(e.query)!==JSON.stringify(n.query),this._diffQuery=this._queryChanged?U(e.query,n.query):[],this._pathChanged&&this.$loading.start&&!this.$loading.manual&&this.$loading.start(),t.prev=4,t.next=7,j(e);case 7:a=t.sent,!this._pathChanged&&this._queryChanged&&a.some(function(t){var e=t.options.watchQuery;return!0===e||!!Array.isArray(e)&&e.some(function(t){return o._diffQuery[t]})})&&this.$loading.start&&!this.$loading.manual&&this.$loading.start(),i(),t.next=19;break;case 12:t.prev=12,t.t0=t.catch(4),t.t0=t.t0||{},r=t.t0.statusCode||t.t0.status||t.t0.response&&t.t0.response.status||500,this.error({statusCode:r,message:t.t0.message}),this.$nuxt.$emit("routeChanged",e,n,t.t0),i(!1);case 19:case"end":return t.stop()}},t,this,[[4,12]])}))).apply(this,arguments)}function Te(t,e){return _e.serverRendered&&e&&D(t,e),t._Ctor=t,t}function $e(t,e,n){var i=this,a=[],r=!1;if(void 0!==n&&(a=[],n.middleware&&(a=a.concat(n.middleware)),t.forEach(function(t){t.options.middleware&&(a=a.concat(t.options.middleware))})),a=a.map(function(t){return"function"==typeof t?t:("function"!=typeof u[t]&&(r=!0,i.error({statusCode:500,message:"Unknown middleware "+t})),u[t])}),!r)return function t(e,n){return!e.length||n._redirected||n._errored?Promise.resolve():Y(e[0],n).then(function(){return t(e.slice(1),n)})}(a,e)}function Ae(t,e,n){return Ee.apply(this,arguments)}function Ee(){return(Ee=s()(regeneratorRuntime.mark(function t(e,n,i){var a,r,o,s,u,h,l,p,f,d,m,v,g,x,y,b,w=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==this._pathChanged||!1!==this._queryChanged){t.next=2;break}return t.abrupt("return",i());case 2:return Pe=e===n?[]:I(n,a=[]).map(function(t,e){return H(n.matched[a[e]].path)(n.params)}),r=!1,o=function(t){n.path===t.path&&w.$loading.finish&&w.$loading.finish(),n.path!==t.path&&w.$loading.pause&&w.$loading.pause(),r||(r=!0,i(t))},t.next=7,X(Ce,{route:e,from:n,next:o.bind(this)});case 7:if(this._dateLastError=Ce.nuxt.dateErr,this._hadError=!!Ce.nuxt.err,(u=I(e,s=[])).length){t.next=25;break}return t.next=14,$e.call(this,u,Ce.context);case 14:if(!r){t.next=16;break}return t.abrupt("return");case 16:return t.next=18,this.loadLayout("function"==typeof A.layout?A.layout(Ce.context):A.layout);case 18:return h=t.sent,t.next=21,$e.call(this,u,Ce.context,h);case 21:if(!r){t.next=23;break}return t.abrupt("return");case 23:return Ce.context.error({statusCode:404,message:"This page could not be found"}),t.abrupt("return",i());case 25:return u.forEach(function(t){t._Ctor&&t._Ctor.options&&(t.options.asyncData=t._Ctor.options.asyncData,t.options.fetch=t._Ctor.options.fetch)}),this.setTransitions(Me(u,e,n)),t.prev=27,t.next=30,$e.call(this,u,Ce.context);case 30:if(!r){t.next=32;break}return t.abrupt("return");case 32:if(!Ce.context._errored){t.next=34;break}return t.abrupt("return",i());case 34:return"function"==typeof(l=u[0].options.layout)&&(l=l(Ce.context)),t.next=38,this.loadLayout(l);case 38:return l=t.sent,t.next=41,$e.call(this,u,Ce.context,l);case 41:if(!r){t.next=43;break}return t.abrupt("return");case 43:if(!Ce.context._errored){t.next=45;break}return t.abrupt("return",i());case 45:p=!0,t.prev=46,f=!0,d=!1,m=void 0,t.prev=50,v=u[Symbol.iterator]();case 52:if(f=(g=v.next()).done){t.next=64;break}if("function"==typeof(x=g.value).options.validate){t.next=56;break}return t.abrupt("continue",61);case 56:return t.next=58,x.options.validate(Ce.context);case 58:if(p=t.sent){t.next=61;break}return t.abrupt("break",64);case 61:f=!0,t.next=52;break;case 64:t.next=70;break;case 66:t.prev=66,t.t0=t.catch(50),d=!0,m=t.t0;case 70:t.prev=70,t.prev=71,f||null==v.return||v.return();case 73:if(t.prev=73,!d){t.next=76;break}throw m;case 76:return t.finish(73);case 77:return t.finish(70);case 78:t.next=84;break;case 80:return t.prev=80,t.t1=t.catch(46),this.error({statusCode:t.t1.statusCode||"500",message:t.t1.message}),t.abrupt("return",i());case 84:if(p){t.next=87;break}return this.error({statusCode:404,message:"This page could not be found"}),t.abrupt("return",i());case 87:return t.next=89,Promise.all(u.map(function(t,n){if(t._path=H(e.matched[s[n]].path)(e.params),t._dataRefresh=!1,w._pathChanged&&w._queryChanged||t._path!==Pe[n])t._dataRefresh=!0;else if(!w._pathChanged&&w._queryChanged){var i=t.options.watchQuery;!0===i?t._dataRefresh=!0:Array.isArray(i)&&(t._dataRefresh=i.some(function(t){return w._diffQuery[t]}))}if(!w._hadError&&w._isMounted&&!t._dataRefresh)return Promise.resolve();var a=[],r=t.options.asyncData&&"function"==typeof t.options.asyncData,o=!!t.options.fetch,c=r&&o?30:45;if(r){var u=Y(t.options.asyncData,Ce.context).then(function(e){D(t,e),w.$loading.increase&&w.$loading.increase(c)});a.push(u)}if(w.$loading.manual=!1===t.options.loading,o){var h=t.options.fetch(Ce.context);h&&(h instanceof Promise||"function"==typeof h.then)||(h=Promise.resolve(h)),h.then(function(t){w.$loading.increase&&w.$loading.increase(c)}),a.push(h)}return Promise.all(a)}));case 89:r||(this.$loading.finish&&!this.$loading.manual&&this.$loading.finish(),i()),t.next=111;break;case 92:if(t.prev=92,t.t2=t.catch(27),t.t2){t.next=98;break}t.t2={},t.next=100;break;case 98:if("ERR_REDIRECT"!==t.t2.message){t.next=100;break}return t.abrupt("return",this.$nuxt.$emit("routeChanged",e,n,t.t2));case 100:return Pe=[],y=t.t2.response&&t.t2.response.status,t.t2.statusCode=t.t2.statusCode||t.t2.status||y||500,C=t.t2,c.a.config.errorHandler&&c.a.config.errorHandler(C),"function"==typeof(b=A.layout)&&(b=b(Ce.context)),t.next=108,this.loadLayout(b);case 108:this.error(t.t2),this.$nuxt.$emit("routeChanged",e,n,t.t2),i(!1);case 111:case"end":return t.stop()}var C},t,this,[[27,92],[46,80],[50,66,70,78],[71,,73,77]])}))).apply(this,arguments)}function De(t,e){L(t,function(t,e,n,i){return"object"!==r()(t)||t.options||((t=c.a.extend(t))._Ctor=t,n.components[i]=t),t})}function Be(t){this._hadError&&this._dateLastError===this.$options.nuxt.dateErr&&this.error();var e=this.$options.nuxt.err?A.layout:t.matched[0].components.default.options.layout;"function"==typeof e&&(e=e(Ce.context)),this.setLayout(e)}function Ie(t,e){var n=this;!1===this._pathChanged&&!1===this._queryChanged||c.a.nextTick(function(){var e=[],i=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.prototype.concat.apply([],t.matched.map(function(t,n){return Object.keys(t.instances).map(function(i){return e&&e.push(n),t.instances[i]})}))}(t,e),a=I(t,e);i.forEach(function(t,e){if(t&&t.constructor._dataRefresh&&a[e]===t.constructor&&"function"==typeof t.constructor.options.data){var n=t.constructor.options.data.call(t);for(var i in n)c.a.set(t.$data,i,n[i])}}),Be.call(n,t)})}function Le(t){window._nuxtReadyCbs.forEach(function(e){"function"==typeof e&&e(t)}),"function"==typeof window._onNuxtLoaded&&window._onNuxtLoaded(t),ke.afterEach(function(e,n){c.a.nextTick(function(){return t.$nuxt.$emit("routeChanged",e,n)})})}function je(){return(je=s()(regeneratorRuntime.mark(function t(e){var n,i,a,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Ce=e.app,ke=e.router,t.next=4,Promise.all((u=void 0,u=N((o=ke).options.base,o.options.mode),L(o.match(u),function(){var t=s()(regeneratorRuntime.mark(function t(e,n,i,a,r){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof e||e.options){t.next=4;break}return t.next=3,e();case 3:e=t.sent;case 4:return o=Te(B(e),_e.data?_e.data[r]:null),i.components[a]=o,t.abrupt("return",o);case 7:case"end":return t.stop()}},t,this)}));return function(e,n,i,a,r){return t.apply(this,arguments)}}())));case 4:return n=t.sent,i=new c.a(Ce),a=_e.layout||"default",t.next=9,i.loadLayout(a);case 9:if(i.setLayout(a),r=function(){i.$mount("#__nuxt"),c.a.nextTick(function(){Le(i)})},i.setTransitions=i.$options.nuxt.setTransitions.bind(i),n.length&&(i.setTransitions(Me(n,ke.currentRoute)),Pe=ke.currentRoute.matched.map(function(t){return H(t.path)(ke.currentRoute.params)})),i.$loading={},_e.error&&i.error(_e.error),ke.beforeEach(Re.bind(i)),ke.beforeEach(Ae.bind(i)),ke.afterEach(De),ke.afterEach(Ie.bind(i)),!_e.serverRendered){t.next=22;break}return r(),t.abrupt("return");case 22:Ae.call(i,ke.currentRoute,ke.currentRoute,function(t){if(!t)return De(ke.currentRoute,ke.currentRoute),Be.call(i,ke.currentRoute),void r();ke.push(t,function(){return r()},function(t){if(!t)return r();console.error(t)})});case 23:case"end":return t.stop()}var o,u},t,this)}))).apply(this,arguments)}Object.assign(c.a.config,{silent:!0,performance:!1}),function(t){return we.apply(this,arguments)}().then(function(t){return je.apply(this,arguments)}).catch(function(t){console.error("[nuxt] Error while initializing app",t)})},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},45:function(t,e,n){},46:function(t,e,n){},47:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},69:function(t,e){"serviceWorker"in navigator?navigator.serviceWorker.register("/fabric-map-vue/sw.js",{scope:"/fabric-map-vue/"}).then(function(t){window.$sw=t}).catch(function(t){console.error("Service worker registration failed:",t)}):console.warn("Service workers are not supported.")},96:function(t,e,n){t.exports=n(157)}},[[96,8,1,9]]]);
//# sourceMappingURL=ad60880ff24272544b61.js.map